import{Q as q,a as A}from"./QPullToRefresh.95bbf1ea.js";import{D as k,E as B,_ as D,G as l,ae as _,J as r,I as a,aJ as T,Q as x,ah as u,ag as $,H as c,af as h,K as S,aK as F,r as N,c as y,F as P,an as z,am as E,L}from"./index.a574533b.js";import{Q as R,b as V}from"./QCard.8b0c055e.js";import{Q as M,a as b,b as m}from"./QItem.135bcd0b.js";import{u as C}from"./dataStore.de99154b.js";import{u as U}from"./use-quasar.c4351920.js";import"./format.60068c62.js";import"./use-timeout.764645c6.js";const W=k({name:"DeviceItem",props:{ealias:{type:Array,required:!0},showStatus:{type:Boolean,required:!1,default:!1},field:{type:String,required:!1,default:"POW"},latest:{type:Number,default:null},ename:{type:String,required:!1},types:{type:Array,required:!1}},setup(e){const p=C(),o=B();return{goToDetails:()=>{o.push({path:`/details/${e.ename}&${e.types[0].value}&${e.ealias[0].value}`}),o.p},props:e,dataStore:p,toUpperFirst:n=>n[0].toUpperCase()+n.substring(1)}}}),j={style:{display:"flex","align-items":"center"}};function K(e,p,o,f,d,n){return l(),_("div",null,[r(R,{id:"device-card",onClick:e.goToDetails,class:F(["card device-card full-height",!e.props.latest&&e.props.showStatus?"text-grey":""])},{default:a(()=>[r(M,null,{default:a(()=>[r(b,{avatar:""},{default:a(()=>[r(T,null,{default:a(()=>[r(x,{size:"md",color:!e.props.latest&&e.props.showStatus?"grey":"green",name:e.props.types?e.dataStore.getIcon(e.props.types[0].value):"info"},null,8,["color","name"])]),_:1})]),_:1}),r(b,null,{default:a(()=>[r(m,{class:"text-center text-h6"},{default:a(()=>[u($(e.props.ealias?e.props.ealias[0].value:"Apparaat"),1)]),_:1}),e.props.latest?(l(),c(m,{key:0,class:"text-center text-h5 text-weight-bold"},{default:a(()=>[u($(e.props.latest/1e3<10?(Math.abs(e.props.latest)/1e3).toFixed(2):(Math.abs(e.props.latest)/1e3).toFixed(0))+" kW ",1)]),_:1})):e.props.showStatus?(l(),c(m,{key:1,class:"text-center text-h5 text-weight-bold"},{default:a(()=>[u(" Uit ")]),_:1})):(l(),c(m,{key:2,class:"text-center text-h5 text-weight-bold"},{default:a(()=>[u("0.00 kW")]),_:1}))]),_:1}),h("div",j,[r(S,{class:"float-right",color:"primary",push:"",round:"",icon:"arrow_right"})])]),_:1})]),_:1},8,["onClick","class"])])}var G=D(W,[["render",K]]);const H=k({name:"DevicesPage",components:{DeviceItem:G},setup(){const e=C(),p=U(),o=N(!1),f=t=>({endTime:new Date,"tagRestrictions.ename":t,field:"POW"}),d=()=>{const t=e.devices.map(s=>s.ename);e.getLast(f(t)).then(s=>{s.forEach(w=>{e.devices.map(g=>g.name);let Q=t.findIndex(g=>g===w.records[0].values.ENAME);Q&&(e.devices[Q].latest=w.last)})})},n=async()=>{o.value=!0,p.loading.show(),await e.getDevices().then(t=>{d()}),o.value=!1,p.loading.hide()};e.devices.length===0?n():d();const v=y(()=>e.devices.filter(t=>t.etype.find(s=>s.value==="boiler"||s.value==="washingmachine"||s.value==="dishwasher"))),i=y(()=>e.devices.filter(t=>t.etype.find(s=>s.value==="inverter"||s.value==="powermeter"||s.value==="solarpanel"||s.value==="solarpannel"))),I=y(()=>e.devices.filter(t=>t.types.includes("battery")));return{dataStore:e,refresh:t=>{n(),t()},loading:o,powerMeters:i,devices:v,batteries:I}}}),J={class:"page-title"},O=h("span",null," Apparaten",-1),X={class:"row q-col-gutter-sm",id:"device-items"},Y={key:0};function Z(e,p,o,f,d,n){const v=P("device-item");return l(),c(q,{onRefresh:e.refresh,color:"accent"},{default:a(()=>[r(V,{class:"q-px-md"},{default:a(()=>[h("div",J,[O,r(S,{flat:"",icon:"info",color:"grey-4",round:"",size:"lg"},{default:a(()=>[r(A,{"hide-delay":2e3},{default:a(()=>[u("Apparatenoverzicht: Hier zie je een lijst van al je aangesloten apparaten. Klik op een apparaat voor meer gedetailleerde informatie.")]),_:1})]),_:1})]),h("div",X,[(l(!0),_(E,null,z(e.devices,i=>(l(),c(v,{key:i.ename,showStatus:!0,class:"col-12",ealias:i.ealias,ename:i.ename,types:i.etype,latest:i.latest},null,8,["ealias","ename","types","latest"]))),128)),e.devices.length===0?(l(),_("div",Y,"Geen apparaten aangesloten")):L("",!0)])]),_:1})]),_:1},8,["onRefresh"])}var pe=D(H,[["render",Z]]);export{pe as default};
