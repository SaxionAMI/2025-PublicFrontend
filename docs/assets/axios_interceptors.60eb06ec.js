import{u,a as h,b as o}from"./index.a574533b.js";import{b as y}from"./index.a574533b.js";import{u as l}from"./dataStore.de99154b.js";const s=u(),p=h(),f=l();o.interceptors.request.use(e=>(e.headers["content-type"]="application/x-www-form-urlencoded",s.token&&(e.headers.Authorization="Bearer "+s.token),e),e=>Promise.reject(e));let a=!1,n=[];o.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response&&e.response.status===401&&!t._retry&&e.response.data.error_description!=="Invalid user credentials")if(a)try{const r=await new Promise(i=>{n.push(c=>{i(c)})});return t.headers.Authorization=`Bearer ${s.token}`,o(t)}catch(r){console.error("Failed to refresh token:",r)}else{a=!0,t._retry=!0;try{return await s.refreshToken().then(r=>{}),t.headers.Authorization=`Bearer ${s.token}`,await p.getAccountData().then(r=>{f.getDevices()}),n.forEach(r=>r(s.token)),o(t)}catch(r){console.error("Failed to refresh token:",r)}finally{a=!1,n=[]}}return Promise.reject(e)});export{y as axios};
